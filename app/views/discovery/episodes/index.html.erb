<div class="max-w-6xl mx-auto p-6">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold">استكشاف الحلقات</h1>
  </div>

  <%= form_with url: discovery_episodes_path, method: :get, local: true,
                class: "bg-white p-4 rounded-xl border mb-6" do %>
    <div class="grid md:grid-cols-3 gap-4">
      <div>
        <label class="block mb-1">بحث بالعنوان</label>
        <%= text_field_tag :q, @q, class: "w-full px-3 py-2 rounded-lg border",
                              placeholder: "ابحث عن حلقة…" %>
      </div>

      <div>
        <label class="block mb-1">التصنيف</label>
        <%= select_tag :category,
            options_for_select([["الكل",""]] + @categories, @category),
            class: "w-full px-3 py-2 rounded-lg border" %>
      </div>

      <div>
        <label class="block mb-1">المحرّر</label>
        <%= select_tag :editor_id,
            options_for_select([["الكل",""]] + @editors.map{|e| [e.email, e.id]}, @editor_id),
            class: "w-full px-3 py-2 rounded-lg border" %>
      </div>
    </div>

    <div class="mt-4">
      <%= submit_tag "بحث", class: "px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700" %>
      <%= link_to "إعادة ضبط", discovery_episodes_path, class: "px-4 py-2 rounded-xl border ml-2" %>
    </div>
  <% end %>

  <div class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3">
    <% @episodes.each do |ep| %>
      <%= link_to discovery_episode_path(ep), class: "bg-white rounded-xl shadow overflow-hidden block" do %>
        <div class="relative aspect-video bg-black/5">
          <%= image_tag ep.thumbnail_best, alt: ep.title, class: "w-full h-full object-cover" %>
          <div class="absolute inset-0 grid place-items-center">
            <div class="w-12 h-12 rounded-full bg-black/60 text-white grid place-items-center">▶</div>
          </div>
        </div>
        <div class="p-4">
          <div class="font-semibold mb-1"><%= ep.title %></div>
          <div class="text-sm text-slate-600 line-clamp-2"><%= ep.description %></div>
        </div>
      <% end %>
    <% end %>
  </div>
  <div class="mt-6 flex justify-center">
    <%= paginate @episodes, params: { q: @q, category: @category, editor_id: @editor_id } %>
  </div>
</div>

<style>
  .pagination { @apply flex gap-2 flex-wrap; direction: rtl; }
  .pagination a, .pagination span {
    @apply px-3 py-1.5 rounded-lg border text-sm;
  }
  .pagination .current { @apply bg-indigo-600 text-white border-indigo-600; }
  .pagination .disabled { @apply opacity-40 cursor-not-allowed; }
</style>
